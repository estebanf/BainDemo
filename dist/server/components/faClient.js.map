{"version":3,"sources":["components/faClient.js"],"names":["accessToken","getToken","url","faClient","method","headers","form","grant_type","username","login","password","err","response","body","console","log","JSON","parse","access_token","getOptions","queryString","opts","merge","qs","callApi","cb","query","getFiles","project","q","limit","rows","start","fl","getFacets","facets","addFolder","name","json","id","ext","desc","path","location","optsArchive","archive","command","data","target","find","o","optsDelete","delFiles","join","optsMove","ids","moveFiles","targetId"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AACA;AACA;AACA;;AAEA;AACA,IAAIA,cAAc,EAAlB;AACA,SAASC,QAAT,GAAoB;AAClB,yBAAQ;AACLC,SAAK,sBAAOC,QAAP,CAAgBD,GAAhB,GAAsB,kBADtB;AAELE,YAAQ,MAFH;AAGLC,aAAS;AACN,uBAAiB,oBADX,EACgC;AACxC,sBAAgB;AAFR,KAHJ;AAOJC,UAAK;AACHC,kBAAY,UADT;AAEHC,gBAAU,sBAAOL,QAAP,CAAgBM,KAFvB;AAGHC,gBAAU,sBAAOP,QAAP,CAAgBO;AAHvB;AAPD,GAAR,EAYI,UAASC,GAAT,EAAaC,QAAb,EAAsBC,IAAtB,EAA2B;AAC3B,QAAGF,GAAH,EAAO;AACLG,cAAQC,GAAR,CAAYJ,GAAZ;AACD;AACDX,kBAAcgB,KAAKC,KAAL,CAAWJ,IAAX,EAAiBK,YAA/B;AACD,GAjBH;AAmBD;AACD,IAAGlB,eAAe,EAAlB,EAAqB;AACnBC;AACD;AACD,SAASkB,UAAT,CAAoBjB,GAApB,EAAwBkB,WAAxB,EAAoC;AAClC,MAAIC,OAAO;AACTnB,SAAK,sBAAOC,QAAP,CAAgBD,GAAhB,GAAsBA,GADlB;AAETE,YAAO,MAFE;AAGTC,aAAQ;AACN,uBAAiB,YAAYL,WADvB;AAEN,sBAAgB;AAFV;AAHC,GAAX;AAQA,MAAGoB,WAAH,EAAe;AACb,qBAAEE,KAAF,CAAQD,IAAR,EAAa;AACXE,UAAGH;AADQ,KAAb;AAGD;AACD,SAAOC,IAAP;AACD;;AAED,SAASG,OAAT,CAAiBH,IAAjB,EAAsBI,EAAtB,EAAyB;AACvB,yBAAQJ,IAAR,EAAa,UAASV,GAAT,EAAaC,QAAb,EAAsBC,IAAtB,EAA2B;AACtC,QAAGF,GAAH,EAAO;AACLG,cAAQC,GAAR,CAAYJ,GAAZ;AACD,KAFD,MAGI;AACF,UAAGc,EAAH,EAAM;AACJA,WAAGb,QAAH,EAAYC,IAAZ;AACD;AACF;AACF,GATD;AAUD;;kBAEc;AACba,SAAO,eAASN,WAAT,EAAqBK,EAArB,EAAwB;AAC7BD,YAAQL,WAAW,2CAAX,EAAuDC,WAAvD,CAAR,EAA4EK,EAA5E;AACD,GAHY;AAIbE,YAAS,kBAASC,OAAT,EAAiBH,EAAjB,EAAoB;AAC3B,QAAIJ,OAAOF,WAAW,2CAAX,EACX;AACEU,SAAG,uBAAsBD,OAAtB,GAA+B,KADpC;AAEEE,aAAO,KAFT;AAGEC,YAAK,KAHP;AAIEC,aAAM,GAJR;AAKEC,UAAI;AALN,KADW,CAAX;AAQAT,YAAQH,IAAR,EAAaI,EAAb;AACD,GAdY;AAebS,aAAU,mBAAST,EAAT,EAAY;AACpB,QAAIJ,OAAOF,WAAW,2CAAX,EACX;AACEU,SAAE,GADJ;AAEEC,aAAM,IAFR;AAGEC,YAAK,IAHP;AAIEC,aAAM,GAJR;AAKEC,UAAG,cALL;AAMEE,cAAO;AANT,KADW,CAAX;AASAX,YAAQH,IAAR,EAAaI,EAAb;AAED,GA3BY;AA4BbW,aAAW,mBAASC,IAAT,EAAcZ,EAAd,EAAiB;AAC1B,QAAIJ,OAAO,iBAAEC,KAAF,CAAQH,WAAW,0CAAX,CAAR,EAA+D;AACxEmB,YAAK;AACHC,YAAG,EADA;AAEHC,aAAI,GAFD;AAGHC,cAAKJ,IAHF;AAIHK,cAAM,sBAAOvC,QAAP,CAAgBwC,QAAhB,GAA2B,GAA3B,GAAiCN;AAJpC;AADmE,KAA/D,CAAX;AAQAb,YAAQH,IAAR,EAAa,UAAST,QAAT,EAAmBC,IAAnB,EAAwB;AACnC,UAAI+B,cAAc,iBAAEtB,KAAF,CAAQH,WAAW,0CAAX,CAAR,EAA+D;AAC/EmB,cAAK;AACHC,cAAG,EADA;AAEHC,eAAI,GAFD;AAGHC,gBAAM,YAAYJ,IAHf;AAIHK,gBAAM,sBAAOvC,QAAP,CAAgB0C,OAAhB,GAA0B,GAA1B,GAAgCR;AAJnC;AAD0E,OAA/D,CAAlB;AAQAb,cAAQoB,WAAR,EAAoB,UAAShC,QAAT,EAAkBC,IAAlB,EAAuB;AACzC,YAAGY,EAAH,EAAO;AAAEA,aAAGb,QAAH,EAAYC,IAAZ;AAAmB;AAC7B,OAFD;AAGD,KAZD;AAaD,GAlDY;AAmDbgC,WAAS,iBAASC,OAAT,EAAiBrB,EAAjB,EAAoB;AAC3B,QAAIJ,OAAO,iBAAEC,KAAF,CAAQH,WAAW,2BAAX,CAAR,EAAgD;AACzDf,cAAQ;AADiD,KAAhD,CAAX;AAGAoB,YAAQH,IAAR,EAAa,UAAST,QAAT,EAAkBC,IAAlB,EAAuB;AAClC,UAAIkC,OAAO/B,KAAKC,KAAL,CAAWJ,IAAX,CAAX;AACA;AACA,UAAImC,SAAS,iBAAEC,IAAF,CAAOF,IAAP,EAAY,UAASG,CAAT,EAAY;AAAE,eAAOA,EAAEb,IAAF,IAAU,YAAYS,QAAQlB,OAArC;AAA8C,OAAxE,CAAb;AACA,UAAIuB,aAAYhC,WAAW,qCAAqC2B,QAAQM,QAAR,CAAiBC,IAAjB,CAAsB,OAAtB,CAArC,GAAsE,IAAjF,CAAhB;AACA7B,cAAQ2B,UAAR,EAAmB,UAASvC,QAAT,EAAkBC,IAAlB,EAAuB;AACxC;AACA,YAAIyC,WAAWnC,WAAW,yBAAX,EAAqC;AAClDoC,eAAIT,QAAQU,SAAR,CAAkBH,IAAlB,CAAuB,GAAvB,CAD8C;AAElDI,oBAAUT,OAAOT;AAFiC,SAArC,CAAf;AAIAf,gBAAQ8B,QAAR,EAAiB,UAAS1C,QAAT,EAAkBC,IAAlB,EAAuB;AACpC,cAAGY,EAAH,EAAO;AAAEA;AAAQ;AACpB,SAFD;AAGD,OATD;AAWD,KAhBD;AAiBD;AAxEY,C","file":"faClient.js","sourcesContent":["import request from 'request';\nimport config from '../config/environment';\nimport _ from 'lodash';\n//DELETE:  http://fa.everteam.us:8080/storage/api/files/delete?ids=%5B%22bXZXMDNLRllTS2svZTBhOTNjMDQtYzM5YS00Njg5LTllNDYtNGU2NDg0OWVjMzcx%22%5D\n//MOVE: http://fa.everteam.us:8080/storage/api/files/move?ids=bXZXMDNLRllTS2svNThmZDkxYmEtNGExYi00ZDQ0LWIxNjAtNmY0ZjlhZGRlZDVi&targetId=dzlZdTNsSXJGUXMv\n//REPOS: http://fa.everteam.us:8080/storage/api/repositories\n\n// require('request-debug')(request);\nvar accessToken = \"\"\nfunction getToken() {\n  request({\n    \turl: config.faClient.url + '/uaa/oauth/token',\n    \tmethod: 'POST',\n    \theaders: {\n        'Authorization': 'Basic d2ViX2FwcDo=',// + new Buffer(config.fa.username + ':' + config.fa.password).toString('base64'),\n    \t\t'Content-Type': 'application/x-www-form-urlencoded'\n    \t},\n      form:{\n        grant_type: 'password',\n        username: config.faClient.login,\n        password: config.faClient.password\n    \t}\n    },function(err,response,body){\n      if(err){\n        console.log(err);\n      }\n      accessToken = JSON.parse(body).access_token\n    })\n\n}\nif(accessToken == \"\"){\n  getToken();\n}\nfunction getOptions(url,queryString){\n  var opts = {\n    url: config.faClient.url + url,\n    method:'POST',\n    headers:{\n      'Authorization': 'Bearer ' + accessToken,\n      'Content-Type': 'application/json'\n    }\n  }\n  if(queryString){\n    _.merge(opts,{\n      qs:queryString\n    })\n  }\n  return opts;\n}\n\nfunction callApi(opts,cb){\n  request(opts,function(err,response,body){\n    if(err){\n      console.log(err);\n    }\n    else{\n      if(cb){\n        cb(response,body)\n      }\n    }\n  })\n}\n\nexport default {\n  query: function(queryString,cb){\n    callApi(getOptions('/analytics/api/collections/fs-docs/select',queryString),cb);\n  },\n  getFiles:function(project,cb){\n    var opts = getOptions('/analytics/api/collections/fs-docs/select',\n    {\n      q: 'folderPath: (\\\"00-'+ project +'\\\")',\n      limit: '100',\n      rows:'100',\n      start:'0',\n      fl: 'cs_uid,fileName,fileType,folder,lastModified,lastAccessed,NE_SSN,doc_type,text_NePos'\n    });\n    callApi(opts,cb);\n  },\n  getFacets:function(cb){\n    var opts = getOptions('/analytics/api/collections/fs-docs/select',\n    {\n      q:'*',\n      limit:'10',\n      rows:'20',\n      start:'0',\n      fl:'score,cs_uid',\n      facets:'fields.folderPath,fields.cs_lang,fields.category,fields.company,fields.creator,fields.fileType,fields.msg_from,ranges.lastAccessed,ranges.lastModified,ranges.fileSize,fields.fileName,fields.NE_PERSON,fields.NE_ORGANISATION,fields.NE_LOCATION'\n    });\n    callApi(opts,cb);\n\n  },\n  addFolder: function(name,cb){\n    var opts = _.merge(getOptions('/analytics/api/collections/fs-docs/ds/fs'),{\n      json:{\n        id:'',\n        ext:'*',\n        desc:name,\n        path: config.faClient.location + '/' + name\n      }\n    });\n    callApi(opts,function(response, body){\n      var optsArchive = _.merge(getOptions('/analytics/api/collections/fs-docs/ds/fs'),{\n        json:{\n          id:'',\n          ext:'*',\n          desc: 'Archive' + name,\n          path: config.faClient.archive + '/' + name\n        }\n      });\n      callApi(optsArchive,function(response,body){\n        if(cb) { cb(response,body) }\n      });\n    });\n  },\n  archive: function(command,cb){\n    var opts = _.merge(getOptions('/storage/api/repositories'),{\n      method: 'GET'\n    });\n    callApi(opts,function(response,body){\n      var data = JSON.parse(body);\n      // var source = _.find(data,function(o) { return o.name == command.project })\n      var target = _.find(data,function(o) { return o.name == 'Archive' + command.project })\n      var optsDelete= getOptions('/storage/api/files/delete?ids=[\"' + command.delFiles.join('\\\",\\\"') + '\"]');\n      callApi(optsDelete,function(response,body){\n        // console.log(response);\n        var optsMove = getOptions('/storage/api/files/move',{\n          ids:command.moveFiles.join(','),\n          targetId: target.id\n        })\n        callApi(optsMove,function(response,body){\n            if(cb) { cb (); }\n        })\n      })\n\n    })\n  }\n}\n"]}